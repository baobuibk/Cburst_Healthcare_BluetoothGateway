{% extends "base.html" %}
{% block content %}
<h1>System Configuration</h1>
<form id="config-form">
    <h2>Data Processor Settings</h2>
    <label>Window Size (s): <input type="number" name="WINDOW_SIZE"></label><br>
    <label>RSSI Threshold: <input type="number" name="RSSI_THRESHOLD"></label><br>
    <label>Freq Threshold: <input type="number" name="FREQ_THRESHOLD"></label><br>
    <label>Max Frequency: <input type="number" name="MAX_FREQ"></label><br>
    <label>W1 (RSSI Weight): <input type="number" step="0.1" name="W1"></label><br>
    <label>W2 (Freq Weight): <input type="number" step="0.1" name="W2"></label><br>
    <label>Max Workers: <input type="number" name="MAX_WORKERS"></label><br>
    <label>Max Buffer/Beacon: <input type="number" name="MAX_BUFFER_PER_BEACON"></label><br>
    <h2>Redis Settings</h2>
    <label>Queue Host: <input type="text" name="QUEUE_HOST"></label><br>
    <label>Queue Port: <input type="number" name="QUEUE_PORT"></label><br>
    <button type="submit">Save</button>
</form>
{% endblock %}
{% block scripts %}
<script>
    fetch('/api/config')
        .then(response => response.json())
        .then(config => {
            for (const [key, value] of Object.entries(config)) {
                document.getElementsByName(key)[0].value = value;
            }
        });

    document.getElementById('config-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = {};
        new FormData(this).forEach((value, key) => formData[key] = value);
        fetch('/api/config', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(formData)
        }).then(() => alert('Config saved'));
    });
</script>
{% endblock %}